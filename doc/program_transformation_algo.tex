\documentclass{article}
\usepackage{algorithm}
\usepackage{algpseudocode}
\title{Program Transformation}
\begin{document}
\maketitle

%\renewcommand{\thealgorithm}{}
%\algrenewcommand{\textproc}[1]{$#1$}

\begin{algorithm}
  \caption{analyse a module}
  \begin{algorithmic}[1]
    \Function {analyse}{$M$}
      \ForAll {$F \in M$}
        \State $controlStructs \gets getTopLevelControlStructs(F.BList)$ \Comment{ControlStruct is a conditional branch or loop}
        \ForAll {$S \in controlStructs$}
          \State $analyse(S)$
        \EndFor
      \EndFor
    \EndFunction
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}
  \caption{analyse a control structure}
  \begin{algorithmic}[1]
    \Function {analyse}{$S$}
      \If {$isTransformable(S)$}
        \State $transform(S)$
      \Else
        \State $controlStructs \gets getTopLevelControlStructs(S.BList)$
        \ForAll {$S' \in controlStructs$}
          \State $analyse(S')$ \Comment{do recursive transformation}
        \EndFor
      \EndIf
    \EndFunction
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}
  \caption{check if a control structure is transformable}
  \begin{algorithmic}[1]
    \Function {isTransformable}{$S$}
    \If {$\forall var\in def(S),\ var\notin OUT[S]$}
      \State \textbf{return true}
    \Else
      \State \textbf{return false}
    \EndIf
    \EndFunction
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}
  \caption{transform a control structure}
  \begin{algorithmic}[1]
    \Function {transform}{$S$}
      \ForAll {$B \in S$}
        \ForAll {$I \in B$}
          \If {$isCritical(I)$} \Comment{check if dereference or getElementOfArray}
            \State $insert\ I\ before\ S$
          \EndIf
        \EndFor
      \EndFor
      \State $B \gets getSuccessor(S)$
      \State $insert\ unconditional\ branch\ \textbf{br\ label\ B}\ before\ S$
    \EndFunction
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}
  \caption{get all of the top level control structures in the basic block list}
  \begin{algorithmic}[1]
    \Function {getTopLevelControlStructs}{$Blist$}
      \State $ret \gets empty\ ControlStruct\ list$
      \ForAll {$B \in BList$}
        \If {$B\ is\ loop\ header$}
          \State {$LS \gets loop\ structure\ of\ B$}
          \State {$add\ LS\ to\ ret$}
        \Else \Comment{B is conditional branch or switch}
          \State {$B' \gets postdominator\ of\ B$}
          \State {}
        \EndIf
      \EndFor
      \State {$$}
    \EndFunction
  \end{algorithmic}
\end{algorithm}

%TODO
%\renewcommand{\thealgorithm}{}
%\begin{algorithm}
%  \caption{design of ControlStruct class}
%  \begin{algorithmic}[1]
%    \State \textbf{class} ControlStruct \{
%    \State \textbf{public}:
%    \State bool isTransformable();
%    \State 
%    \State 
%    \State \}
%  \end{algorithmic}
%\end{algorithm}

\end{document}
